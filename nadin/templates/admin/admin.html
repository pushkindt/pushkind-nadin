{% extends "base.html" %}

{% block content %}

<div class="container">
	<div class="accordion" id="settingsFormsAccordion">
		<div class="accordion-item">
			<h2 class="accordion-header" id="oneSFormHeading">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#oneSFormCollapse" aria-expanded="false" aria-controls="oneSFormCollapse">
					Настройка приложения
				</button>
			</h2>
			<div id="oneSFormCollapse" class="accordion-collapse collapse" aria-labelledby="oneSFormHeading"
				data-bs-parent="#settingsFormsAccordion">
				<div class="accordion-body">
					<form method="POST" action="{{ url_for('admin.SaveAppSettings') }}" enctype="multipart/form-data">
						<div class="row my-3">
							{{ forms['app'].csrf_token(id=False) }}
							{{ forms['app'].email.label(class_ = 'col-md-2 form-label') }}
							<div class="col-md-10">
								{{ forms['app'].email(class_ = 'form-control') }}
							</div>
						</div>
						<div class="row mb-3">
							<div class="col-md-10 offset-md-2">
								<div class="form-check">
									{{ forms['app'].enable(class_ = 'form-check-input') }}
									{{ forms['app'].enable.label(class_ = 'form-check-label') }}
								</div>
							</div>
						</div>
						<div class="row mb-3">
							<div class="col-md-10 offset-md-2">
								<div class="form-check">
									{{ forms['app'].single_category_orders(class_ = 'form-check-input') }}
									{{ forms['app'].single_category_orders.label(class_ = 'form-check-label') }}
								</div>
							</div>
						</div>
						<div class="row mb-3">
							{{ forms['app'].alert.label(class_ = 'col-md-2 form-label') }}
							<div class="col-md-10">
								{{ forms['app'].alert(class_ = 'form-control') }}
							</div>
						</div>
						<div class="row mb-3">
							{{ forms['app'].order_id_bias.label(class_ = 'col-md-2 form-label') }}
							<div class="col-md-10">
								{{ forms['app'].order_id_bias(class_ = 'form-control') }}
							</div>
						</div>
						<div class="row mb-3">
							{{ forms['app'].image.label(class_ = 'col-md-2 form-label') }}
							<div class="col-md-10">
								{{forms['app'].image(class_='form-control', accept='image/png')}}
							</div>
						</div>
						<div class="row mb-3">
							<div class="col">
								{{ forms['app'].submit(id=False, class_ = 'btn btn-primary text-white') }}
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>

		<div class="accordion-item">
			<h2 class="accordion-header" id="categoriesFormHeading">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
					data-bs-target="#categoriesFormCollapse" aria-expanded="false"
					aria-controls="categoriesFormCollapse">
					Категории
				</button>
			</h2>
			<div id="categoriesFormCollapse" class="accordion-collapse collapse" aria-labelledby="categoriesFormHeading"
				data-bs-parent="#settingsFormsAccordion">
				<div class="accordion-body">
					<div class="row">
						<div class="col">
							<input class="form-control" id="categoryFilter" type="text" placeholder="Фильтр..">
						</div>
						<div class="col-auto">
							<a class="btn btn-primary text-white" href="#" role="button" data-bs-toggle="modal"
								data-bs-target="#addCategoryModal"><i class="bi bi-plus-square"></i></a>
						</div>
					</div>
					<div class="row d-none d-sm-flex fw-bold">
						<div class="col overflow-hidden">
							Название
						</div>
						<div class="col overflow-hidden">
							Ответственный/ФДБ/БДР/БДДС/Код
						</div>
					</div>
					<div id="categoryList">
						{% for category in categories %}
						<div class="row my-1 py-1 border-bottom">
							<div class="col-sm">
								<span class="d-sm-none fw-bold">Название:</span>
								{{ category.name }}
							</div>
							<div class="col-sm">
								<form class="categoryForm" action="{{ url_for('admin.SaveCategoryResponsibility') }}"
									method="POST" id="categoryForm{{category.id}}" enctype="multipart/form-data">
									<div class="row py-1">
										<div class="col">
											{{ forms['edit_category'].csrf_token(id=False) }}
											{{ forms['edit_category'].category_id(class_ = 'd-none', hidden = '',
											value=category.id, id=False) }}
											{{ forms['edit_category'].code(class_ = 'form-control code', id=False,
											placeholder='Код', value = category.code or '') }}
										</div>
									</div>
									<div class="row py-1">
										<div class="col">
											{{forms['edit_category'].image(class_='form-control', accept='image/*')}}
										</div>
									</div>
									<div class="row py-1">
										<div class="col text-start">
											{{ forms['edit_category'].submit(id=False, class_='btn btn-primary
											text-white') }}
										</div>
										<div class="col text-end">
											<a class="btn btn-danger text-white"
												href="{{url_for('admin.RemoveCategory', category_id=category.id)}}"
												role="button"
												onclick="confirm('Вы действительно хотите удалить?')">Удалить</a>
										</div>
									</div>
								</form>
							</div>
						</div>
						{% endfor %}
					</div>
				</div>
			</div>
		</div>

	</div>
</div>

<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="addCategoryModalLabel">ДОБАВИТЬ КАТЕГОРИЮ</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<form method="POST" action="{{ url_for('admin.AddCategory') }}">
				<div class="modal-body">
					{{ forms['add_category'].csrf_token(id=False) }}
					<div class="mb-3">
						{{ forms['add_category'].category_name.label(id=False, class_='form-label',
						for='addCategoryName') }}
						{{ forms['add_category'].category_name(id='addCategoryName', class_='form-control') }}
					</div>
					<div class="mb-3">
						{{ forms['add_category'].parent.label(id=False, class_='form-label',
						for='addCategoryParent') }}
						{{ forms['add_category'].parent(id='addCategoryParent', class_='form-select',
						placeholder='Выберите категорию...', value=0) }}
					</div>
				</div>
				<div class="modal-footer">
					{{ forms['add_category'].submit(id=False, class_='btn btn-primary text-white') }}
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
				</div>
			</form>
		</div>
	</div>
</div>


{% endblock %}

{% block scripts %}
<script>
	$(document).ready(function () {

	var categories = [{% for category in categories %} {{ category | safe }}, {% endfor %}];


	$("#categoryFilter").on("keyup", function () {
		let value = $(this).val().toLowerCase();
		$("#categoryList>.row").filter(function () {
			$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
		});
	});

	});
</script>
{% endblock %}