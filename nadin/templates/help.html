{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.js"></script>
{% endblock %}

{% block content %}


<div class="container">
	<div class="accordion" id="helpPageAccordion">
		<div class="accordion-item">
			<h2 class="accordion-header" id="statsHeading">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#statsCollapse" aria-expanded="false" aria-controls="statsCollapse">
					Статистика
				</button>
			</h2>
			<div id="statsCollapse" class="accordion-collapse collapse" aria-labelledby="statsHeading" data-bs-parent="#helpPageAccordion">
				<div class="accordion-body table-responsive-lg">
					{{ stats.getvalue() | safe }}
				</div>
			</div>
		</div>
		<div class="accordion-item">
			<h2 class="accordion-header" id="actionsHeading">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#actionsCollapse" aria-expanded="false" aria-controls="actionsCollapse">
					Права на выполнение действий
				</button>
			</h2>
			<div id="actionsCollapse" class="accordion-collapse collapse" aria-labelledby="actionsHeading" data-bs-parent="#helpPageAccordion">
				<div class="accordion-body table-responsive-lg">
					<table class="table table-striped">
						<caption>*Все означает "все зарегистрированные заявки", *Только свои означает "только заявки, для которых
							пользователь является инициатором"</caption>
						<thead>
							<tr>
								<th scope="col">Действия/Права</th>
								<th scope="col">Администратор</th>
								<th scope="col">Инициатор</th>
								<th scope="col">Валидатор</th>
								<th scope="col">Закупщик</th>
								<th scope="col">Наблюдатель</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th scope="row">Просмотр заявок</th>
								<td class="text-success">Все</td>
								<td class="text-warning">Только свои</td>
								<td class="text-success">Все</td>
								<td class="text-success">Все</td>
								<td class="text-success">Все</td>
							</tr>
							<tr>
								<th scope="row">Объединение/Разделение заявок</th>
								<td class="text-success">Все</td>
								<td class="text-warning">Только свои</td>
								<td class="text-danger">Нет</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Указать проект, категории</th>
								<td class="text-success">Все</td>
								<td class="text-warning">Только свои</td>
								<td class="text-success">Все</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Указать статьи БДР и БДДС</th>
								<td class="text-success">Все</td>
								<td class="text-warning">Только свои</td>
								<td class="text-success">Все</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Оставить комментарий</th>
								<td class="text-success">Все</td>
								<td class="text-warning">Только свои</td>
								<td class="text-success">Все</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Клонировать заявку</th>
								<td class="text-success">Все</td>
								<td class="text-warning">Только свои</td>
								<td class="text-danger">Нет</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Уведомить согласующих</th>
								<td class="text-success">Все</td>
								<td class="text-warning">Только свои</td>
								<td class="text-danger">Нет</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Отправить заявку поставщику</th>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
								<td class="text-danger">Нет</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Выгрузить заявку в Excel</th>
								<td class="text-success">Все</td>
								<td class="text-warning">Только свои</td>
								<td class="text-success">Все</td>
								<td class="text-success">Все</td>
								<td class="text-success">Все</td>
							</tr>
							<tr>
								<th scope="row">Выгрузить заявку для 1С</th>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
								<td class="text-success">Все</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Согласование заявки</th>
								<td class="text-danger">Нет</td>
								<td class="text-danger">Нет</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Создать новую заявку</th>
								<td class="text-success">Разрешено</td>
								<td class="text-success">Разрешено</td>
								<td class="text-danger">Нет</td>
								<td class="text-success">Разрешено</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Законтрактовать</th>
								<td class="text-danger">Нет</td>
								<td class="text-danger">Нет</td>
								<td class="text-danger">Нет</td>
								<td class="text-success">Все</td>
								<td class="text-danger">Нет</td>
							</tr>
							<tr>
								<th scope="row">Управление лимитами</th>
								<td class="text-success">Разрешено</td>
								<td class="text-danger">Нет</td>
								<td class="text-danger">Нет</td>
								<td class="text-success">Разрешено</td>
								<td class="text-danger">Нет</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		
		<div class="accordion-item">
			<h2 class="accordion-header" id="projectsHeading">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#projectsCollapse" aria-expanded="false" aria-controls="projectsCollapse">
					Подписки на проекты
				</button>
			</h2>
			<div id="projectsCollapse" class="accordion-collapse collapse" aria-labelledby="projectsHeading" data-bs-parent="#helpPageAccordion">
				<div class="accordion-body">
					<div class="row">
						<div class="col">
							<input class="form-control" id="projectsFilter" type="text" placeholder="Фильтр..">
						</div>
					</div>
					<div class="table-responsive-md">
						<table class="table table-striped table-responsive">
							<thead>
								<tr>
									<th scope="col">Проект</th>
									<th scope="col" style="width: 20%">Роли</th>
									<th scope="col" style="width: 20%">Пользователи</th>
								</tr>
							</thead>
							<tbody>
								{% for project in projects %}
								<tr class="project">
									<th scope="row">{{ project }}</th>
									<td style="width: 20%">
										{% for position in projects[project]['positions'] %}
										{{ position }}<br>
										{% endfor %}
									</td>
									<td style="width: 20%">
										{% for user in projects[project]['users'] %}
										{% include '_user.popover.html' %}{{user.name}}<br>
										{% endfor %}
									</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		
		<div class="accordion-item">
			<h2 class="accordion-header" id="categoriesHeading">
				<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#categoriesCollapse" aria-expanded="false" aria-controls="categoriesCollapse">
					Подписки на категории
				</button>
			</h2>
			<div id="categoriesCollapse" class="accordion-collapse collapse" aria-labelledby="categoriesHeading" data-bs-parent="#helpPageAccordion">
				<div class="accordion-body">
					<div class="row">
						<div class="col">
							<input class="form-control" id="categoriesFilter" type="text" placeholder="Фильтр..">
						</div>
					</div>
					<div class="table-responsive-md">
						<table class="table table-striped table-responsive">
							<thead>
								<tr>
									<th scope="col">Категория</th>
									<th scope="col" style="width: 20%">Роли</th>
									<th scope="col" style="width: 20%">Пользователи</th>
								</tr>
							</thead>
							<tbody>
								{% for category in categories %}
								<tr class="category">
									<th scope="row">{{ category }}</th>
									<td style="width: 20%">
										{% for position in categories[category]['positions'] %}
										{{ position }}<br>
										{% endfor %}
									</td>
									<td style="width: 20%">
										{% for user in categories[category]['users'] %}
										{% include '_user.popover.html' %}{{ user.name }}<br>
										{% endfor %}
									</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>		
	</div>
</div>

{% endblock %}

{% block scripts %}

<script>
	$(document).ready(function () {
		$("#projectsFilter").on("keyup", function () {
			let value = $(this).val().toLowerCase();
			$(".project").filter(function () {
				$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
			});
		});
		$("#categoriesFilter").on("keyup", function () {
			let value = $(this).val().toLowerCase();
			$(".category").filter(function () {
				$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
			});
		});
		$('#statsTable').DataTable();
	});
</script>
{% endblock %}